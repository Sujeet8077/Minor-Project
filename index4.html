<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudySync | Final Version</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- CSS STYLES --- */
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --dark: #2d3436;
            --light: #f5f6fa;
            --white: #ffffff;
            --danger: #ff7675;
            --success: #00b894;
            --warning: #fdcb6e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

        body { background-color: var(--light); height: 100vh; display: flex; }

        /* Sidebar */
        .app-container { display: flex; width: 100%; }
        .sidebar {
            width: 250px;
            background-color: var(--white);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .logo { color: var(--primary); margin-bottom: 40px; }
        .nav-links { padding: 0; }
        .nav-links li {
            list-style: none; padding: 15px; cursor: pointer;
            border-radius: 10px; margin-bottom: 10px; color: var(--dark); transition: 0.3s;
        }
        .nav-links li:hover, .nav-links li.active { background-color: var(--secondary); color: var(--white); }
        .nav-links i { margin-right: 10px; }

        .auth-btn-container { border-top: 1px solid #eee; padding-top: 20px; }
        .btn-sidebar {
            width: 100%; padding: 12px; border: none; border-radius: 8px;
            cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        .btn-login { background-color: var(--primary); color: white; }
        .btn-login:hover { background-color: #5649c0; }
        
        /* Main Content */
        .main-content { flex: 1; padding: 40px; overflow-y: auto; }
        .content-section { display: none; animation: fadeIn 0.5s; }
        .active-section { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        .btn-primary {
            padding: 10px 20px; background-color: var(--primary); color: white;
            border: none; border-radius: 5px; cursor: pointer; font-size: 1rem;
        }

        /* --- DASHBOARD TOP ROW (Chart + Stats) --- */
        .dashboard-top {
            display: grid;
            grid-template-columns: 1fr 2fr; /* Chart gets 1 part, Stats get 2 parts */
            gap: 20px;
            margin-bottom: 30px;
        }

        /* CIRCLE CHART STYLES (NEW) */
        .chart-container {
            background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .circular-chart {
            width: 150px; height: 150px;
            border-radius: 50%;
            background: conic-gradient(var(--success) 0deg, #eee 0deg); /* Updated by JS */
            display: flex; justify-content: center; align-items: center;
            position: relative;
            margin-bottom: 15px;
            transition: background 0.5s ease;
        }
        .inner-circle {
            width: 110px; height: 110px;
            background: white; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column;
        }
        .inner-circle h2 { font-size: 1.5rem; color: var(--dark); }
        .inner-circle small { font-size: 0.8rem; color: #888; }
        
        .chart-legend { font-size: 0.9rem; color: #555; }
        .legend-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 5px; }

        /* Stats Grid (Moved here) */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; height: 100%; }
        .stat-card {
            background: white; padding: 25px; border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center;
            display: flex; flex-direction: column; justify-content: center;
        }
        .stat-card h3 { font-size: 1rem; color: #888; margin-bottom: 10px; }
        .stat-card p { font-size: 2rem; font-weight: bold; color: var(--dark); }

        /* Dashboard Mixx Widgets */
        .dashboard-mixx {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;
        }
        .mixx-card {
            background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            height: 300px; overflow-y: auto;
        }
        .mixx-header { font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; color: var(--dark); border-bottom: 1px solid #eee; padding-bottom: 10px;}
        .mixx-header i { margin-right: 10px; color: var(--primary); }

        /* Mini Lists in Dashboard */
        .mini-item {
            padding: 10px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem;
        }
        .mini-item:last-child { border-bottom: none; }
        .status-tag { padding: 3px 8px; border-radius: 10px; font-size: 0.7rem; color: white; }
        .tag-todo { background: var(--warning); color: #333; }
        .tag-res { background: var(--secondary); }
        .tag-group { background: var(--success); }

        /* General Styles for other sections */
        .group-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .group-card {
            background: white; padding: 20px; border-radius: 10px;
            border-left: 5px solid var(--success); display: flex; justify-content: space-between; align-items: center;
        }
        .join-btn {
            background: var(--dark); color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;
        }

        .settings-container { background: white; padding: 30px; border-radius: 15px; max-width: 600px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: var(--dark); }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }

        .resource-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .resource-card { background: white; padding: 20px; border-radius: 10px; border-left: 5px solid var(--primary); position: relative; }
        
        .task-item {
            background: white; padding: 15px; border-radius: 8px; display: flex;
            justify-content: space-between; align-items: center; margin-bottom: 10px;
        }
        .task-item.completed h4 { text-decoration: line-through; color: #aaa; }
        .btn-delete { background: none; border: none; color: var(--danger); cursor: pointer; font-size: 1.2rem; }

        /* Modals */
        .modal {
            display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white; margin: 10% auto; padding: 30px; border-radius: 10px;
            width: 90%; max-width: 400px; text-align: center; position: relative;
        }
        .modal-content input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .modal-content button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; }
        .toggle-link { color: var(--primary); cursor: pointer; text-decoration: underline; margin-top: 10px; display: block;}
        .close { position: absolute; right: 20px; top: 15px; cursor: pointer; font-size: 1.5rem; }

        /* Responsive Fix */
        @media (max-width: 768px) {
            .dashboard-top, .stats-grid, .dashboard-mixx, .group-grid { grid-template-columns: 1fr; }
            .sidebar { display: none; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <nav class="sidebar">
            <div>
                <div class="logo">
                    <h2><i class="fas fa-graduation-cap"></i> StudySync</h2>
                </div>
                <ul class="nav-links">
                    <li class="active" onclick="showSection('dashboard')"><i class="fas fa-chart-pie"></i> Dashboard</li>
                    <li onclick="showSection('resources')"><i class="fas fa-folder-open"></i> Resource Hub</li>
                    <li onclick="showSection('tasks')"><i class="fas fa-check-square"></i> Task Tracker</li>
                    <li onclick="showSection('group-study')"><i class="fas fa-users"></i> Group Study</li>
                    <li onclick="showSection('settings')"><i class="fas fa-cog"></i> Settings</li>
                </ul>
            </div>
            
            <div class="auth-btn-container">
                <button id="sidebar-auth-btn" class="btn-sidebar btn-login" onclick="openAuthModal()">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
            </div>
        </nav>

        <main class="main-content">
            
            <section id="dashboard" class="content-section active-section">
                <header>
                    <h1 id="welcome-msg">Welcome!</h1>
                    <p>Your Data Mixx Overview</p>
                </header>
                
                <div class="dashboard-top">
                    <div class="chart-container">
                        <div class="circular-chart" id="circle-chart">
                            <div class="inner-circle">
                                <h2 id="chart-percent">0%</h2>
                                <small>Completed</small>
                            </div>
                        </div>
                        <div class="chart-legend">
                            <span class="legend-dot" style="background:var(--success)"></span> Done
                            <span class="legend-dot" style="background:#eee; margin-left:10px;"></span> Pending
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card"><h3>Tasks Pending</h3><p id="total-tasks-count">0</p></div>
                        <div class="stat-card"><h3>Shared Resources</h3><p id="total-resources-count">0</p></div>
                        <div class="stat-card"><h3>Active Groups</h3><p id="active-group-count">0</p></div>
                    </div>
                </div>

                <div class="dashboard-mixx">
                    <div class="mixx-card">
                        <div class="mixx-header"><i class="fas fa-list-ul"></i> To-Do List (Top 5)</div>
                        <div id="dash-task-list"></div>
                    </div>
                    <div class="mixx-card">
                        <div class="mixx-header"><i class="fas fa-link"></i> Recent Resources</div>
                        <div id="dash-res-list"></div>
                    </div>
                    <div class="mixx-card">
                        <div class="mixx-header"><i class="fas fa-users"></i> Live Study Rooms</div>
                        <div id="dash-group-list"></div>
                    </div>
                </div>
            </section>

            <section id="resources" class="content-section">
                <header><h1>Resource Hub</h1><button class="btn-primary" onclick="openModal('resource-modal')">+ Add Resource</button></header>
                <div class="resource-grid" id="resource-list"></div>
            </section>

            <section id="tasks" class="content-section">
                <header><h1>Task Tracker</h1><button class="btn-primary" onclick="openModal('task-modal')">+ Add Task</button></header>
                <div id="task-list"></div>
            </section>

            <section id="group-study" class="content-section">
                <header>
                    <h1>Group Study Rooms</h1>
                    <button class="btn-primary" onclick="createRoom()">+ Create New Room</button>
                </header>
                <p style="margin-bottom: 20px; color: #666;">Join an active study session or start your own.</p>
                <div class="group-grid" id="group-list"></div>
            </section>

            <section id="settings" class="content-section">
                <header><h1>Settings</h1></header>
                <div class="settings-container">
                    <div class="form-group">
                        <label>Display Name</label>
                        <input type="text" id="settings-name" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label>Email (Read Only)</label>
                        <input type="email" id="settings-email" placeholder="user@example.com" disabled>
                    </div>
                    <button class="btn-primary" onclick="saveSettings()">Save Changes</button>
                    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                    <button style="background-color: var(--danger); color: white; padding: 10px; border:none; border-radius:5px; cursor:pointer;" onclick="handleLogout()">
                        <i class="fas fa-sign-out-alt"></i> Sign Out
                    </button>
                </div>
            </section>
        </main>
    </div>

    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('auth-modal')">&times;</span>
            <h2 id="auth-title">Sign In</h2>
            <br>
            <input type="text" id="auth-username" placeholder="Username">
            <input type="password" id="auth-password" placeholder="Password">
            <button onclick="handleAuth()" id="auth-action-btn">Login</button>
            <span class="toggle-link" onclick="toggleAuthMode()" id="auth-toggle-text">Don't have an account? Sign Up</span>
        </div>
    </div>

    <div id="resource-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('resource-modal')">&times;</span>
            <h2>Add Resource</h2>
            <input type="text" id="res-title" placeholder="Title">
            <input type="text" id="res-link" placeholder="Link/Description">
            <button onclick="addResource()">Save</button>
        </div>
    </div>

    <div id="task-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('task-modal')">&times;</span>
            <h2>Add Task</h2>
            <input type="text" id="task-desc" placeholder="Task Description">
            <input type="date" id="task-date">
            <button onclick="addTask()">Save</button>
        </div>
    </div>

    <script>
        // --- DATA & STATE ---
        let resources = JSON.parse(localStorage.getItem('studyResources')) || [];
        let tasks = JSON.parse(localStorage.getItem('studyTasks')) || [];
        
        let groups = [
            { id: 1, name: "ðŸ”¥ Physics Marathon", host: "Rahul", members: 5 },
            { id: 2, name: "â˜• Late Night Coding", host: "Dev", members: 12 }
        ];

        // Auth Logic
        let storedUser = localStorage.getItem('currentUser'); 
        let currentUser = null;
        if (storedUser) {
            try {
                const parsedUser = JSON.parse(storedUser);
                currentUser = parsedUser.name || parsedUser; 
            } catch (e) {
                currentUser = storedUser;
            }
        }
        let isLoginMode = true; 

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
            renderResources();
            renderTasks();
            renderGroups();
            updateDashboard(); 
        });

        // --- DASHBOARD MIXX & CHART LOGIC ---
        function updateDashboard() {
            // 1. Update Stats Numbers
            const pendingTasks = tasks.filter(t => !t.completed).length;
            const completedTasks = tasks.filter(t => t.completed).length;
            const totalTasks = tasks.length;
            
            document.getElementById('total-tasks-count').innerText = pendingTasks;
            document.getElementById('total-resources-count').innerText = resources.length;
            document.getElementById('active-group-count').innerText = groups.length;

            // 2. UPDATE CIRCLE CHART
            let percentage = 0;
            if (totalTasks > 0) {
                percentage = Math.round((completedTasks / totalTasks) * 100);
            }
            // Update Text
            document.getElementById('chart-percent').innerText = percentage + "%";
            // Update Gradient (This creates the chart visual)
            document.getElementById('circle-chart').style.background = 
                `conic-gradient(var(--success) ${percentage * 3.6}deg, #eee 0deg)`;

            // 3. Render Widgets
            renderWidgets();
        }

        function renderWidgets() {
            // Tasks
            const dashTaskContainer = document.getElementById('dash-task-list');
            const topTasks = tasks.filter(t => !t.completed).slice(0, 5);
            if(topTasks.length === 0) {
                dashTaskContainer.innerHTML = '<p style="color:#aaa; text-align:center; margin-top:20px;">No pending tasks! ðŸŽ‰</p>';
            } else {
                dashTaskContainer.innerHTML = topTasks.map(t => `
                    <div class="mini-item">
                        <span>${t.desc}</span>
                        <span class="status-tag tag-todo">Due: ${t.date || 'Soon'}</span>
                    </div>`).join('');
            }

            // Resources
            const dashResContainer = document.getElementById('dash-res-list');
            const recentResources = resources.slice(-5).reverse();
            if(recentResources.length === 0) {
                dashResContainer.innerHTML = '<p style="color:#aaa; text-align:center; margin-top:20px;">No resources shared.</p>';
            } else {
                dashResContainer.innerHTML = recentResources.map(r => `
                    <div class="mini-item"><span>${r.title}</span><span class="status-tag tag-res">Link</span></div>`).join('');
            }

            // Groups
            const dashGroupContainer = document.getElementById('dash-group-list');
            dashGroupContainer.innerHTML = groups.map(g => `
                <div class="mini-item">
                    <span>${g.name}</span>
                    <button class="status-tag tag-group" style="border:none; cursor:pointer;" onclick="joinRoom('${g.name}')">Join</button>
                </div>`).join('');
        }

        // --- AUTH FUNCTIONS ---
        function openAuthModal() { if(currentUser) return; document.getElementById('auth-modal').style.display = 'block'; }
        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            const title = document.getElementById('auth-title'); const btn = document.getElementById('auth-action-btn'); const toggle = document.getElementById('auth-toggle-text');
            if(isLoginMode) { title.innerText = "Sign In"; btn.innerText = "Login"; toggle.innerText = "Don't have an account? Sign Up"; } 
            else { title.innerText = "Create Account"; btn.innerText = "Sign Up"; toggle.innerText = "Already have an account? Sign In"; }
        }
        function handleAuth() {
            const userIn = document.getElementById('auth-username').value;
            const passIn = document.getElementById('auth-password').value;
            if(!userIn || !passIn) { alert("Please fill fields"); return; }
            localStorage.setItem('currentUser', userIn); 
            currentUser = userIn;
            alert("Success!"); closeModal('auth-modal'); checkAuthStatus(); location.reload(); 
        }
        function handleLogout() {
            if(confirm("Sign out?")) { localStorage.removeItem('currentUser'); currentUser = null; checkAuthStatus(); location.reload(); }
        }
        function checkAuthStatus() {
            const sidebarBtn = document.getElementById('sidebar-auth-btn');
            const welcomeMsg = document.getElementById('welcome-msg');
            const settingsName = document.getElementById('settings-name');
            const settingsEmail = document.getElementById('settings-email');

            if(currentUser) {
                sidebarBtn.innerHTML = '<i class="fas fa-user"></i> ' + currentUser;
                sidebarBtn.classList.remove('btn-login'); sidebarBtn.style.background = '#e0e0e0'; sidebarBtn.style.color = '#333';
                sidebarBtn.onclick = () => showSection('settings');
                welcomeMsg.innerText = `Welcome back, ${currentUser}!`;
                settingsName.value = currentUser; settingsEmail.value = currentUser.toLowerCase().replace(/\s/g, '') + "@studysync.com";
            } else {
                sidebarBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
                sidebarBtn.classList.add('btn-login'); sidebarBtn.onclick = openAuthModal;
                welcomeMsg.innerText = "Welcome, Guest!"; settingsName.value = ""; settingsEmail.value = "";
            }
        }
        function saveSettings() {
            const newName = document.getElementById('settings-name').value;
            if(newName && currentUser) { localStorage.setItem('currentUser', newName); currentUser = newName; checkAuthStatus(); alert("Settings Saved!"); }
            else { alert("Please sign in first."); }
        }

        // --- GROUP STUDY FUNCTIONS ---
        function renderGroups() {
            document.getElementById('group-list').innerHTML = groups.map(g => `
                <div class="group-card"><div><h3>${g.name}</h3><small>Host: ${g.host} | ${g.members} Members</small></div>
                <button class="join-btn" onclick="joinRoom('${g.name}')">Join</button></div>`).join('');
            updateDashboard();
        }
        function createRoom() {
            if(!currentUser) { alert("Please Sign In."); return; }
            const roomName = prompt("Enter Room Name:");
            if(roomName) { groups.push({ id: Date.now(), name: roomName, host: currentUser, members: 1 }); renderGroups(); }
        }
        function joinRoom(topic) { if(!currentUser) { alert("Please Sign In."); return; } alert(`Joined ${topic} Room!`); }

        // --- CORE FUNCTIONS ---
        function showSection(id) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active-section'));
            document.querySelectorAll('.nav-links li').forEach(l => l.classList.remove('active'));
            document.getElementById(id).classList.add('active-section');
            updateDashboard();
        }
        function openModal(id) { document.getElementById(id).style.display = 'block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        function addResource() {
            const t = document.getElementById('res-title').value;
            const l = document.getElementById('res-link').value;
            if(!t) return;
            resources.push({id: Date.now(), title: t, link: l});
            saveData(); renderResources(); closeModal('resource-modal'); updateDashboard();
        }
        function renderResources() {
            document.getElementById('resource-list').innerHTML = resources.map(r => `
                <div class="resource-card"><h3>${r.title}</h3><p>${r.link}</p>
                <button class="btn-delete" onclick="deleteRes(${r.id})"><i class="fas fa-trash"></i></button></div>`).join('');
        }
        function deleteRes(id) { resources = resources.filter(r => r.id !== id); saveData(); renderResources(); updateDashboard(); }

        function addTask() {
            const d = document.getElementById('task-desc').value;
            if(!d) return;
            tasks.push({id: Date.now(), desc: d, date: document.getElementById('task-date').value, completed: false});
            saveData(); renderTasks(); closeModal('task-modal'); updateDashboard();
        }
        function renderTasks() {
            document.getElementById('task-list').innerHTML = tasks.map(t => `
                <div class="task-item ${t.completed?'completed':''}">
                    <div style="display:flex;align-items:center;gap:10px;">
                        <input type="checkbox" ${t.completed?'checked':''} onchange="toggleTask(${t.id})">
                        <div><h4>${t.desc}</h4><small>${t.date}</small></div>
                    </div>
                    <button class="btn-delete" onclick="delTask(${t.id})"><i class="fas fa-trash"></i></button>
                </div>`).join('');
        }
        function toggleTask(id) { const t = tasks.find(x => x.id === id); t.completed = !t.completed; saveData(); renderTasks(); updateDashboard(); }
        function delTask(id) { tasks = tasks.filter(x => x.id !== id); saveData(); renderTasks(); updateDashboard(); }

        function saveData() {
            localStorage.setItem('studyResources', JSON.stringify(resources));
            localStorage.setItem('studyTasks', JSON.stringify(tasks));
        }
    </script>
</body>
</html>